<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="Inspect the code here:
Code [WIP]  The next I needed to do is to provide feedback to the user that her input is indeed registered. We have the LED matrix for this.
The code for this sketch when compiled in the Arduino Micro:
Sketch uses 12844 bytes (44%) of program storage space. Maximum is 28672 bytes. Global variables use 780 bytes (30%) of dynamic memory, leaving 1780 bytes for local variables." />
<meta name="keywords" content=", bossy, general-purpose-controller" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://mithi.github.io/robotics-blog/blog/bossy/12-coding-4/" />


    <title>
        
            Bossy Matrix: Feedback Test with LEDs :: Mithi&#39;s Robotics Blog  â€” ðŸ‘¾ðŸ¤– todos, docs, notes, learnings, ideas (etc) about robots ðŸ¤–ðŸ‘¾
        
    </title>



<link href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
    type="text/css">



<link rel="stylesheet" href="/robotics-blog/main.min.a71f1ccb2abf86c1f9d46cddfa6403b99497528c340efb7c3589023cc9808b15.css">




<meta itemprop="name" content="Bossy Matrix: Feedback Test with LEDs">
<meta itemprop="description" content="Inspect the code here:
Code [WIP]  The next I needed to do is to provide feedback to the user that her input is indeed registered. We have the LED matrix for this.
The code for this sketch when compiled in the Arduino Micro:
Sketch uses 12844 bytes (44%) of program storage space. Maximum is 28672 bytes. Global variables use 780 bytes (30%) of dynamic memory, leaving 1780 bytes for local variables.">
<meta itemprop="datePublished" content="2020-03-28T01:43:49&#43;08:00" />
<meta itemprop="dateModified" content="2020-03-28T01:43:49&#43;08:00" />
<meta itemprop="wordCount" content="719">
<meta itemprop="image" content="https://mithi.github.io/robotics-blog/"/>



<meta itemprop="keywords" content="bossy,general-purpose-controller," /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://mithi.github.io/robotics-blog/"/>

<meta name="twitter:title" content="Bossy Matrix: Feedback Test with LEDs"/>
<meta name="twitter:description" content="Inspect the code here:
Code [WIP]  The next I needed to do is to provide feedback to the user that her input is indeed registered. We have the LED matrix for this.
The code for this sketch when compiled in the Arduino Micro:
Sketch uses 12844 bytes (44%) of program storage space. Maximum is 28672 bytes. Global variables use 780 bytes (30%) of dynamic memory, leaving 1780 bytes for local variables."/>



    <meta property="article:section" content="bossy" />



    <meta property="article:published_time" content="2020-03-28 01:43:49 &#43;0800 PST" />








    </head>

    <body class="dark-theme">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/robotics-blog" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">Mithi&#39;s Robots</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://mithi.github.io/robotics-blog/blog">Blog</a></li><li><a href="https://mithi.github.io/robotics-blog/misc">Misc</a></li><li><a href="https://ko-fi.com/minimithi">â˜•</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="https://mithi.github.io/robotics-blog/blog/bossy/12-coding-4/">Bossy Matrix: Feedback Test with LEDs</a></h2>

            

            <div class="post-content">
                <blockquote>
<p>Inspect the code here:</p>
<h1 id="code-wiphttpsgithubcommithibossy"><a href="https://github.com/mithi/bossy">Code [WIP]</a></h1>
</blockquote>
<p><img src="/robotics-blog/bossy-matrix-1.gif" alt=""></p>
<p>The next I needed to do is to provide feedback to the user that her input is indeed registered.
We have the LED matrix for this.</p>
<p>The code for this sketch when compiled in the Arduino Micro:</p>
<pre><code>Sketch uses 12844 bytes (44%) of program storage space. Maximum is 28672 bytes.
Global variables use 780 bytes (30%) of dynamic memory, leaving 1780 bytes for local variables. Maximum is 2560 bytes.

</code></pre><p>With the Arduino Uno</p>
<pre><code>Sketch uses 9780 bytes (30%) of program storage space. Maximum is 32256 bytes.
Global variables use 640 bytes (31%) of dynamic memory, leaving 1408 bytes for local variables. Maximum is 2048 bytes.
</code></pre><p>The sketch is pretty simple, the Microcontroller listens for any change of state given the 25
possible sources of inputs (5 potentiometer, 4 3-DOF joysticks, 4 momentary switches, 4 spdt switches),
and provides feedback that such signals are indeed received by turning specific pixels of the 8x8 LED Matrix into a specific color.</p>
<p>Since 64 pixels is not that many, we can toggle between two modes (using the upper left switch)</p>
<p>One of the modes show the joysticks signals while the other shows the potentiometer signals.
Both modes show current state of the 4 momentary switches (buttons) and 4 spdt switches.</p>
<table>
<thead>
<tr>
<th><img src="/robotics-blog/bossy-matrix-2.gif" alt=""></th>
<th><img src="/robotics-blog/bossy-matrix-3.gif" alt=""></th>
</tr>
</thead>
</table>
<p>The loop contains code like this, which pretty much iterates through each input
check if the state of that input has changed, and then proceeds to update the LED Matrix appropriately.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-arduino" data-lang="arduino">
  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> NUMBER_OF_BUTTONS; i<span style="color:#f92672">++</span>) {
    <span style="color:#66d9ef">if</span> (bossy.hasChangedState(buttons[i].id)) {
      update_button_display(buttons[i]);
    }
  }

  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> NUMBER_OF_SWITCHES; i<span style="color:#f92672">++</span>) {
    <span style="color:#66d9ef">if</span> (bossy.hasChangedState(switches[i].id)) {
      update_switch_display(switches[i]);
    }
  }

  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> NUMBER_OF_STICKS; i<span style="color:#f92672">++</span>) {
    <span style="color:#66d9ef">if</span> (bossy.hasChangedState(sticks[i].id)) {
      update_stick_display(sticks[i]);
    }
  }

  <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> NUMBER_OF_POTENTIOMETERS; i<span style="color:#f92672">++</span>) {
    <span style="color:#66d9ef">if</span> (bossy.hasChangedState(potentiometers[i])) {
      update_pot_display(i, potentiometers[i]);
    }
  }

</code></pre></div><p>Updating the display given current state of the input could look something like this</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-arduino" data-lang="arduino"><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">uint8_t</span> button_colors[NUMBER_OF_STATES] <span style="color:#f92672">=</span>  {LED_GREEN, LED_GREEN, LED_GREEN, LED_GREEN, LED_RED};

<span style="color:#66d9ef">void</span> <span style="color:#a6e22e">update_button_display</span>(<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Button button) {
  <span style="color:#66d9ef">uint8_t</span> state <span style="color:#f92672">=</span> bossy.savedState(button.id);
  <span style="color:#66d9ef">uint8_t</span> color <span style="color:#f92672">=</span> button_colors[state];
  <span style="color:#66d9ef">uint8_t</span> x <span style="color:#f92672">=</span> button.pixel[Xi];
  <span style="color:#66d9ef">uint8_t</span> y <span style="color:#f92672">=</span> button.pixel[Yi];
  matrix.drawPixel(x, y, color);

  matrix.writeDisplay();
}
matrix.writeDisplay();
}
</code></pre></div><p>I&rsquo;ve created a header file with structs to be able to do this smoothly</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-arduino" data-lang="arduino">
<span style="color:#75715e">#ifndef MatrixHelpers_h
</span><span style="color:#75715e">#define MatrixHelpers_h
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;BossyConstants.h&#34;</span><span style="color:#75715e">
</span><span style="color:#75715e"></span>
<span style="color:#75715e">/**********************
</span><span style="color:#75715e">  LED MATRIX DISPLAY HELPERS
</span><span style="color:#75715e">*************************/</span>
<span style="color:#75715e">// these structs are used for displaying state changes in the led matrix
</span><span style="color:#75715e">// the pixels are the locations in the matrix that would change
</span><span style="color:#75715e">// depending on the state of the joystick
</span><span style="color:#75715e"></span><span style="color:#75715e">#define Xi 0
</span><span style="color:#75715e">#define Yi 1
</span><span style="color:#75715e"></span>
<span style="color:#75715e">#define NUMBER_OF_STICKS 8
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">struct</span> Stick {
  <span style="color:#66d9ef">uint8_t</span> id;
  <span style="color:#66d9ef">uint8_t</span> first_pixel[<span style="color:#ae81ff">2</span>];
  <span style="color:#66d9ef">uint8_t</span> second_pixel[<span style="color:#ae81ff">2</span>];
};

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Stick jxupleft <span style="color:#f92672">=</span> {LEFT_JOYSTICK_UPPER_X, {<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>}, {<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">2</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Stick jyupleft <span style="color:#f92672">=</span> {LEFT_JOYSTICK_UPPER_Y, {<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}, {<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span>}};

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Stick jxdownleft <span style="color:#f92672">=</span> {LEFT_JOYSTICK_LOWER_X, {<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">5</span>}, {<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">5</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Stick jydownleft <span style="color:#f92672">=</span> {LEFT_JOYSTICK_LOWER_Y, {<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">6</span>}, {<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">4</span>}};

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Stick jxupright <span style="color:#f92672">=</span> {RIGHT_JOYSTICK_UPPER_X, {<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">2</span>}, {<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">2</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Stick jyupright <span style="color:#f92672">=</span> {RIGHT_JOYSTICK_UPPER_Y, {<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">3</span>}, {<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1</span>}};

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Stick jxdownright <span style="color:#f92672">=</span> {RIGHT_JOYSTICK_LOWER_X, {<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">5</span>}, {<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">5</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Stick jydownright <span style="color:#f92672">=</span> {RIGHT_JOYSTICK_LOWER_Y, {<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">6</span>}, {<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">4</span>}};

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Stick sticks[NUMBER_OF_STICKS] <span style="color:#f92672">=</span> {
  jxupleft,
  jyupleft,
  jxdownleft,
  jydownleft,

  jxupright,
  jyupright,
  jxdownright,
  jydownright
};


<span style="color:#75715e">#define NUMBER_OF_BUTTONS 8
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">struct</span> Button {
  <span style="color:#66d9ef">uint8_t</span> id;
  <span style="color:#66d9ef">uint8_t</span> pixel[<span style="color:#ae81ff">2</span>];
};

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Button bupleft <span style="color:#f92672">=</span> {LEFT_BUTTON_UPPER, {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Button bdownleft <span style="color:#f92672">=</span> {LEFT_BUTTON_LOWER, {<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">7</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Button bupright <span style="color:#f92672">=</span> {RIGHT_BUTTON_UPPER, {<span style="color:#ae81ff">7</span> , <span style="color:#ae81ff">0</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Button bdownright <span style="color:#f92672">=</span> {RIGHT_BUTTON_LOWER, {<span style="color:#ae81ff">7</span> , <span style="color:#ae81ff">7</span>}};

<span style="color:#75715e">// joystick buttons
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Button jupleft <span style="color:#f92672">=</span> {LEFT_JOYSTICK_UPPER_BUTTON, {<span style="color:#ae81ff">2</span> , <span style="color:#ae81ff">2</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Button jdownleft <span style="color:#f92672">=</span> {LEFT_JOYSTICK_LOWER_BUTTON, {<span style="color:#ae81ff">2</span> , <span style="color:#ae81ff">5</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Button jupright <span style="color:#f92672">=</span> {RIGHT_JOYSTICK_UPPER_BUTTON, {<span style="color:#ae81ff">5</span> , <span style="color:#ae81ff">2</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Button jdownright <span style="color:#f92672">=</span> {RIGHT_JOYSTICK_LOWER_BUTTON, {<span style="color:#ae81ff">5</span> , <span style="color:#ae81ff">5</span>}};

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> Button buttons[NUMBER_OF_BUTTONS] <span style="color:#f92672">=</span> {
  bupleft,
  bdownleft,
  bupright,
  bdownright,

  jupleft,
  jdownleft,
  jupright,
  jdownright,
};

<span style="color:#75715e">#define NUMBER_OF_SWITCHES 4
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">struct</span> SwitchSPDT {
  <span style="color:#66d9ef">uint8_t</span> id;
  <span style="color:#66d9ef">uint8_t</span> first_pixel[<span style="color:#ae81ff">2</span>];
  <span style="color:#66d9ef">uint8_t</span> second_pixel[<span style="color:#ae81ff">2</span>];
  <span style="color:#66d9ef">uint8_t</span> third_pixel[<span style="color:#ae81ff">2</span>];
};

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> SwitchSPDT swupleft {LEFT_SWITCH_UPPER, {<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>}, {<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>}, {<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">0</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> SwitchSPDT swdownleft {LEFT_SWITCH_LOWER, {<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">7</span>}, {<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">7</span>}, {<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">7</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> SwitchSPDT swupright {RIGHT_SWITCH_UPPER, {<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">0</span>}, {<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">0</span>}, {<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">0</span>}};
<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> SwitchSPDT swdownright {RIGHT_SWITCH_LOWER, {<span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">7</span>}, {<span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">7</span>}, {<span style="color:#ae81ff">6</span>, <span style="color:#ae81ff">7</span>}};

<span style="color:#66d9ef">const</span> <span style="color:#66d9ef">struct</span> SwitchSPDT switches[NUMBER_OF_SWITCHES] <span style="color:#f92672">=</span> {swupleft, swdownleft, swupright, swdownright};

<span style="color:#75715e">#define NUMBER_OF_POTENTIOMETERS 5
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#66d9ef">uint8_t</span> potentiometers[NUMBER_OF_POTENTIOMETERS] <span style="color:#f92672">=</span> {POT_LEFT, POT_LEFT_CENTER, POT_CENTER, POT_RIGHT_CENTER, POT_RIGHT};

<span style="color:#75715e">#endif
</span></code></pre></div><blockquote>
<p>Inspect the code here:</p>
<h1 id="code-wiphttpsgithubcommithibossy-1"><a href="https://github.com/mithi/bossy">Code [WIP]</a></h1>
</blockquote>

            </div>
        </article>

        <hr />

        <div class="post-info">
  				<p>
  					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://mithi.github.io/robotics-blog/tags/bossy">bossy</a></span><span class="tag"><a href="https://mithi.github.io/robotics-blog/tags/general-purpose-controller">general-purpose-controller</a></span>
  				</p>
  			</div>

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2020</span>
            
            <span>ðŸ‘¾ðŸ¤– Mithi</span>
            <span> <a href="https://mithi.github.io/robotics-blog/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a></span>
        </div>
    </div>
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by <a href="http://gohugo.io">Hugo</a></span>
            <span>Made with &#10084; by <a href="https://github.com/rhazdon">Djordje Atlialp</a></span>
        </div>
    </div>
</footer>

            
        </div>

        




<script type="text/javascript" src="/robotics-blog/bundle.min.2d5469329143160ae2456a69c3c76dc2d0a3b212b46afe291a51bd68650ed6f8697e001dab54f1c272c77ce08092a8c55e5bb4314e0ee334aab4b927ec896638.js" integrity="sha512-LVRpMpFDFgriRWppw8dtwtCjshK0av4pGlG9aGUO1vhpfgAdq1TxwnLHfOCAkqjFXlu0MU4O4zSqtLkn7IlmOA=="></script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-142507629-2', 'auto');
        ga('send', 'pageview');
    </script>



    </body>
</html>
